# æ— è¿¹å¡å°”æ›¼æ»¤æ³¢ï¼ˆUnscented Kalman Filter, UKFï¼‰

<div align="center">

![éœ€è¦æ’å…¥: æ— è¿¹å¡å°”æ›¼æ»¤æ³¢Sigmaç‚¹é‡‡æ ·ç¤ºæ„å›¾]

</div>

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [åŸºæœ¬åŸç†](#åŸºæœ¬åŸç†)
- [æ— è¿¹å˜æ¢](#æ— è¿¹å˜æ¢)
- [ç®—æ³•æµç¨‹](#ç®—æ³•æµç¨‹)
- [å‚æ•°è®¾ç½®](#å‚æ•°è®¾ç½®)
- [å®ç°ç¤ºä¾‹](#å®ç°ç¤ºä¾‹)
- [ä¸EKFæ¯”è¾ƒ](#ä¸ekfæ¯”è¾ƒ)
- [ä¼˜åŠ¿ä¸å±€é™æ€§](#ä¼˜åŠ¿ä¸å±€é™æ€§)
- [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
- [æ€»ç»“](#æ€»ç»“)

## æ¦‚è¿°

æ— è¿¹å¡å°”æ›¼æ»¤æ³¢ï¼ˆUnscented Kalman Filter, UKFï¼‰æ˜¯å¤„ç†éçº¿æ€§ç³»ç»Ÿçš„ä¸€ç§é«˜çº§æ»¤æ³¢ç®—æ³•ï¼Œç”±Jeffrey Uhlmannå’ŒSimon Julieråœ¨20ä¸–çºª90å¹´ä»£æœ«æå‡ºã€‚ä¸æ‰©å±•å¡å°”æ›¼æ»¤æ³¢ï¼ˆEKFï¼‰é€šè¿‡çº¿æ€§åŒ–å¤„ç†éçº¿æ€§ä¸åŒï¼ŒUKFé‡‡ç”¨æ— è¿¹å˜æ¢ï¼ˆUnscented Transform, UTï¼‰æ¥å¤„ç†éçº¿æ€§ï¼Œä¸éœ€è¦è®¡ç®—å¤æ‚çš„é›…å¯æ¯”çŸ©é˜µï¼Œä¸”èƒ½å¤Ÿè·å¾—æ›´é«˜çš„ä¼°è®¡ç²¾åº¦ã€‚

<details>
<summary><b>ğŸ“š å†å²èƒŒæ™¯</b></summary>

æ— è¿¹å¡å°”æ›¼æ»¤æ³¢æœ€åˆç”±Jeffrey Uhlmannåœ¨ç‰›æ´¥å¤§å­¦åšå£«ç ”ç©¶æœŸé—´æå‡ºï¼Œåæ¥ä¸Simon Julierå…±åŒå®Œå–„ã€‚UKFçš„æ ¸å¿ƒæ˜¯æ— è¿¹å˜æ¢ï¼ˆUTï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ç¡®å®šæ€§é‡‡æ ·æ–¹æ³•ï¼Œç”¨äºä¼°è®¡éçº¿æ€§å˜æ¢åçš„æ¦‚ç‡åˆ†å¸ƒã€‚

UKFçš„åç§°ä¸­çš„"æ— è¿¹"ï¼ˆUnscentedï¼‰ä¸€è¯æ¥æºäºä¸€ç§é™¤è‡­å‰‚å“ç‰Œï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•èƒ½æ¶ˆé™¤ä¼ ç»ŸEKFä¸­ç”±äºçº¿æ€§åŒ–å¼•å…¥çš„"è‡­æ°”"ï¼ˆè¯¯å·®ï¼‰ã€‚è¿™ç§å¹½é»˜çš„å‘½ååæ˜ äº†è¯¥æ–¹æ³•çš„ä¸»è¦ä¼˜åŠ¿ï¼šå‡å°‘ç”±çº¿æ€§åŒ–å¸¦æ¥çš„è¿‘ä¼¼è¯¯å·®ã€‚

UKFåœ¨å®é™…åº”ç”¨ä¸­é€æ¸æ›¿ä»£EKFï¼Œæˆä¸ºå¤„ç†éçº¿æ€§ç³»ç»Ÿçš„é‡è¦å·¥å…·ï¼Œç‰¹åˆ«æ˜¯åœ¨èˆªç©ºèˆªå¤©ã€æœºå™¨äººå¯¼èˆªå’Œé‡‘èå»ºæ¨¡ç­‰é¢†åŸŸã€‚

</details>

## åŸºæœ¬åŸç†

æ— è¿¹å¡å°”æ›¼æ»¤æ³¢çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**é€šè¿‡ä¸€ç»„ç²¾å¿ƒé€‰æ‹©çš„æ ·æœ¬ç‚¹ï¼ˆç§°ä¸ºsigmaç‚¹ï¼‰æ¥æ•æ‰æ¦‚ç‡åˆ†å¸ƒçš„ç»Ÿè®¡ç‰¹æ€§ï¼Œç„¶åå°†è¿™äº›ç‚¹é€šè¿‡éçº¿æ€§å‡½æ•°ä¼ æ’­ï¼Œä»¥è·å¾—å˜æ¢ååˆ†å¸ƒçš„ç»Ÿè®¡ç‰¹æ€§**ã€‚

UKFåŸºäºä¸¤ä¸ªå…³é”®å‡è®¾ï¼š
1. éçº¿æ€§å˜æ¢çš„é«˜é˜¶çŸ©å¯ä»¥é€šè¿‡sigmaç‚¹çš„ä¼ æ’­æ¥æ•è·
2. ä¸€ç»„æœ‰é™çš„ç‚¹å¯ä»¥ç”¨æ¥è¿‘ä¼¼é«˜æ–¯åˆ†å¸ƒ

ä¸EKFçº¿æ€§åŒ–éçº¿æ€§å‡½æ•°ä¸åŒï¼ŒUKFç›´æ¥ä½¿ç”¨éçº¿æ€§å‡½æ•°å¤„ç†è¿™äº›sigmaç‚¹ï¼Œä¸éœ€è¦ä»»ä½•å½¢å¼çš„çº¿æ€§åŒ–ã€‚

## æ— è¿¹å˜æ¢

æ— è¿¹å˜æ¢æ˜¯UKFçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œç”¨äºä¼°è®¡éçº¿æ€§å‡½æ•°ä½œç”¨äºæ¦‚ç‡åˆ†å¸ƒåçš„ç»Ÿè®¡ç‰¹æ€§ã€‚

<details>
<summary><b>ğŸ” æ— è¿¹å˜æ¢çš„è¯¦ç»†æ­¥éª¤</b></summary>

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡å€¼ä¸ºÎ¼ï¼Œåæ–¹å·®ä¸ºÎ£çš„nç»´éšæœºå˜é‡xï¼Œä»¥åŠä¸€ä¸ªéçº¿æ€§å‡½æ•°y = f(x)ã€‚æ— è¿¹å˜æ¢çš„ç›®æ ‡æ˜¯ä¼°è®¡yçš„å‡å€¼å’Œåæ–¹å·®ã€‚

æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç”Ÿæˆ2n+1ä¸ªsigmaç‚¹ï¼š
   ```
   Xâ‚€ = Î¼
   Xáµ¢ = Î¼ + (âˆš((n+Î»)Î£))áµ¢,  i = 1,...,n
   Xáµ¢â‚Šâ‚™ = Î¼ - (âˆš((n+Î»)Î£))áµ¢â‚‹â‚™,  i = n+1,...,2n
   ```
   å…¶ä¸­(âˆš((n+Î»)Î£))áµ¢è¡¨ç¤ºçŸ©é˜µå¹³æ–¹æ ¹çš„ç¬¬iåˆ—

2. ä¸ºæ¯ä¸ªsigmaç‚¹åˆ†é…æƒé‡ï¼š
   ```
   Wâ‚€áµ = Î»/(n+Î»)
   Wâ‚€á¶œ = Î»/(n+Î») + (1-Î±Â²+Î²)
   Wáµ¢áµ = Wáµ¢á¶œ = 1/(2(n+Î»)),  i = 1,...,2n
   ```
   å…¶ä¸­mè¡¨ç¤ºå‡å€¼æƒé‡ï¼Œcè¡¨ç¤ºåæ–¹å·®æƒé‡

3. å°†sigmaç‚¹é€šè¿‡éçº¿æ€§å‡½æ•°ä¼ æ’­ï¼š
   ```
   Yáµ¢ = f(Xáµ¢),  i = 0,...,2n
   ```

4. è®¡ç®—å˜æ¢ååˆ†å¸ƒçš„ç»Ÿè®¡ç‰¹æ€§ï¼š
   ```
   Î¼y = âˆ‘áµ¢â‚Œâ‚€^(2n) Wáµ¢áµ Yáµ¢
   Î£y = âˆ‘áµ¢â‚Œâ‚€^(2n) Wáµ¢á¶œ (Yáµ¢ - Î¼y)(Yáµ¢ - Î¼y)áµ€
   ```

</details>

### Sigmaç‚¹é€‰æ‹©

sigmaç‚¹çš„é€‰æ‹©æ˜¯UKFçš„å…³é”®éƒ¨åˆ†ï¼Œè¿™äº›ç‚¹éœ€è¦æ•è·åˆ†å¸ƒçš„ç»Ÿè®¡ç‰¹æ€§ã€‚æ ‡å‡†UKFä½¿ç”¨2n+1ä¸ªsigmaç‚¹ï¼Œå…¶ä¸­næ˜¯çŠ¶æ€å‘é‡çš„ç»´åº¦ï¼š

<div align="center">

$\mathcal{X}_0 = \bar{x}$

$\mathcal{X}_i = \bar{x} + \left(\sqrt{(n+\lambda)P_x}\right)_i, \quad i=1,\ldots,n$

$\mathcal{X}_{i+n} = \bar{x} - \left(\sqrt{(n+\lambda)P_x}\right)_i, \quad i=1,\ldots,n$

</div>

å…¶ä¸­ï¼š
- $\bar{x}$ æ˜¯çŠ¶æ€å‘é‡çš„å‡å€¼
- $P_x$ æ˜¯çŠ¶æ€çš„åæ–¹å·®çŸ©é˜µ
- $\lambda = \alpha^2(n+\kappa)-n$ æ˜¯ç¼©æ”¾å‚æ•°
- $\left(\sqrt{(n+\lambda)P_x}\right)_i$ è¡¨ç¤ºçŸ©é˜µå¹³æ–¹æ ¹çš„ç¬¬iåˆ—

### æƒé‡è®¡ç®—

æ¯ä¸ªsigmaç‚¹éƒ½æœ‰ç›¸åº”çš„æƒé‡ï¼Œç”¨äºè®¡ç®—å‡å€¼å’Œåæ–¹å·®ï¼š

<div align="center">

$W_0^m = \frac{\lambda}{n+\lambda}$

$W_0^c = \frac{\lambda}{n+\lambda} + (1-\alpha^2+\beta)$

$W_i^m = W_i^c = \frac{1}{2(n+\lambda)}, \quad i=1,\ldots,2n$

</div>

å…¶ä¸­ï¼š
- $W_i^m$ æ˜¯ç”¨äºè®¡ç®—å‡å€¼çš„æƒé‡
- $W_i^c$ æ˜¯ç”¨äºè®¡ç®—åæ–¹å·®çš„æƒé‡
- $\alpha$, $\beta$, $\kappa$ æ˜¯ç®—æ³•å‚æ•°

## ç®—æ³•æµç¨‹

UKFçš„ç®—æ³•æµç¨‹ä¸æ ‡å‡†å¡å°”æ›¼æ»¤æ³¢ç±»ä¼¼ï¼Œä½†åœ¨é¢„æµ‹å’Œæ›´æ–°æ­¥éª¤ä¸­ä½¿ç”¨æ— è¿¹å˜æ¢ä»£æ›¿çº¿æ€§åŒ–ã€‚

<details>
<summary><b>ğŸ”„ UKFç®—æ³•æµç¨‹å›¾</b></summary>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹çŠ¶æ€ä¼°è®¡   â”‚     â”‚ 1. ç”Ÿæˆsigmaç‚¹       â”‚
â”‚ xâ‚€ å’Œ Pâ‚€      â”‚â”€â”€â”€â”€â–ºâ”‚ 2. ä¼ æ’­sigmaç‚¹       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ 3. è®¡ç®—å…ˆéªŒå‡å€¼å’Œåæ–¹å·®â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸‹ä¸€æ—¶é—´æ­¥     â”‚â—„â”€â”€â”€â”€â”‚ 1. ç”Ÿæˆæ–°sigmaç‚¹     â”‚
â”‚ k = k+1       â”‚     â”‚ 2. è®¡ç®—æµ‹é‡é¢„æµ‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ 3. è®¡ç®—å¡å°”æ›¼å¢ç›Š    â”‚
                      â”‚ 4. æ›´æ–°çŠ¶æ€ä¼°è®¡      â”‚
                      â”‚ 5. æ›´æ–°åæ–¹å·®çŸ©é˜µ    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    æµ‹é‡å€¼ zâ‚–         â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

### é¢„æµ‹æ­¥éª¤

1. **ç”Ÿæˆsigmaç‚¹**ï¼š
   <div align="center">
   $\mathcal{X}_{k-1} = [\hat{x}_{k-1|k-1} \quad \hat{x}_{k-1|k-1}+\gamma\sqrt{P_{k-1|k-1}} \quad \hat{x}_{k-1|k-1}-\gamma\sqrt{P_{k-1|k-1}}]$
   </div>
   å…¶ä¸­ $\gamma = \sqrt{n+\lambda}$

2. **ä¼ æ’­sigmaç‚¹**ï¼š
   <div align="center">
   $\mathcal{X}_{k|k-1} = f(\mathcal{X}_{k-1}, u_k)$
   </div>

3. **è®¡ç®—é¢„æµ‹å‡å€¼**ï¼š
   <div align="center">
   $\hat{x}_{k|k-1} = \sum_{i=0}^{2n} W_i^m \mathcal{X}_{i,k|k-1}$
   </div>

4. **è®¡ç®—é¢„æµ‹åæ–¹å·®**ï¼š
   <div align="center">
   $P_{k|k-1} = \sum_{i=0}^{2n} W_i^c [\mathcal{X}_{i,k|k-1}-\hat{x}_{k|k-1}][\mathcal{X}_{i,k|k-1}-\hat{x}_{k|k-1}]^T + Q_k$
   </div>

### æ›´æ–°æ­¥éª¤

1. **ç”Ÿæˆç”¨äºè§‚æµ‹çš„sigmaç‚¹**ï¼š
   <div align="center">
   $\mathcal{X}_{k|k-1} = [\hat{x}_{k|k-1} \quad \hat{x}_{k|k-1}+\gamma\sqrt{P_{k|k-1}} \quad \hat{x}_{k|k-1}-\gamma\sqrt{P_{k|k-1}}]$
   </div>

2. **è®¡ç®—è§‚æµ‹é¢„æµ‹**ï¼š
   <div align="center">
   $\mathcal{Z}_{k|k-1} = h(\mathcal{X}_{k|k-1})$
   
   $\hat{z}_{k|k-1} = \sum_{i=0}^{2n} W_i^m \mathcal{Z}_{i,k|k-1}$
   </div>

3. **è®¡ç®—è§‚æµ‹åæ–¹å·®å’Œäº’åæ–¹å·®**ï¼š
   <div align="center">
   $P_{zz} = \sum_{i=0}^{2n} W_i^c [\mathcal{Z}_{i,k|k-1}-\hat{z}_{k|k-1}][\mathcal{Z}_{i,k|k-1}-\hat{z}_{k|k-1}]^T + R_k$
   
   $P_{xz} = \sum_{i=0}^{2n} W_i^c [\mathcal{X}_{i,k|k-1}-\hat{x}_{k|k-1}][\mathcal{Z}_{i,k|k-1}-\hat{z}_{k|k-1}]^T$
   </div>

4. **è®¡ç®—å¡å°”æ›¼å¢ç›Š**ï¼š
   <div align="center">
   $K_k = P_{xz} P_{zz}^{-1}$
   </div>

5. **æ›´æ–°çŠ¶æ€ä¼°è®¡**ï¼š
   <div align="center">
   $\hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k(z_k - \hat{z}_{k|k-1})$
   </div>

6. **æ›´æ–°åæ–¹å·®çŸ©é˜µ**ï¼š
   <div align="center">
   $P_{k|k} = P_{k|k-1} - K_k P_{zz} K_k^T$
   </div>

## å‚æ•°è®¾ç½®

UKFç®—æ³•æœ‰ä¸‰ä¸ªä¸»è¦å‚æ•°ï¼Œå®ƒä»¬å½±å“sigmaç‚¹çš„åˆ†å¸ƒå’Œæƒé‡è®¡ç®—ï¼š

<details open>
<summary><b>âš™ï¸ UKFå‚æ•°è¯¦è§£</b></summary>

| å‚æ•° | è¯´æ˜ | å…¸å‹å€¼ | å½±å“ |
|------|------|--------|------|
| Î± | å†³å®šsigmaç‚¹å›´ç»•å‡å€¼çš„æ‰©æ•£ç¨‹åº¦ | 0.001 ~ 1 | è¾ƒå°çš„å€¼ä½¿sigmaç‚¹æ›´é›†ä¸­åœ¨å‡å€¼é™„è¿‘ |
| Î² | èåˆå…ˆéªŒåˆ†å¸ƒçš„çŸ¥è¯† | 2ï¼ˆé«˜æ–¯åˆ†å¸ƒçš„æœ€ä¼˜å€¼ï¼‰ | å½±å“åæ–¹å·®ä¼°è®¡ä¸­é«˜é˜¶é¡¹çš„æƒé‡ |
| Îº | è¾…åŠ©ç¼©æ”¾å‚æ•° | 0 æˆ– 3-n | æä¾›é¢å¤–çš„è‡ªç”±åº¦æ¥è°ƒæ•´sigmaç‚¹ |

æœ€ä½³å‚æ•°é€‰æ‹©å–å†³äºå…·ä½“åº”ç”¨å’Œç³»ç»Ÿç‰¹æ€§ã€‚ç»éªŒè¡¨æ˜ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨ï¼Œè®¾ç½®Î±ä¸ºå°å€¼ï¼ˆå¦‚0.1ï¼‰ï¼ŒÎ²ä¸º2ï¼ŒÎºä¸º0æˆ–3-né€šå¸¸èƒ½è·å¾—è‰¯å¥½ç»“æœã€‚

</details>

## å®ç°ç¤ºä¾‹

<details>
<summary><b>ğŸ’» ç®€åŒ–çš„UKF Pythonå®ç°</b></summary>

```python
import numpy as np
from scipy.linalg import cholesky

class UnscentedKalmanFilter:
    def __init__(self, dim_x, dim_z, dt, fx, hx):
        self.dim_x = dim_x  # çŠ¶æ€å‘é‡ç»´åº¦
        self.dim_z = dim_z  # è§‚æµ‹å‘é‡ç»´åº¦
        self.dt = dt        # æ—¶é—´æ­¥é•¿
        
        # UKFå‚æ•°
        self.alpha = 0.1    # é»˜è®¤æ‰©æ•£å‚æ•°
        self.beta = 2.0     # å¯¹äºé«˜æ–¯åˆ†å¸ƒçš„æœ€ä¼˜å€¼
        self.kappa = 0.0    # è¾…åŠ©ç¼©æ”¾å‚æ•°
        
        # è¿‡ç¨‹å‡½æ•°å’Œè§‚æµ‹å‡½æ•°
        self.fx = fx        # çŠ¶æ€è½¬ç§»å‡½æ•°
        self.hx = hx        # è§‚æµ‹å‡½æ•°
        
        # åæ–¹å·®çŸ©é˜µ
        self.Q = np.eye(dim_x)  # è¿‡ç¨‹å™ªå£°åæ–¹å·®
        self.R = np.eye(dim_z)  # æµ‹é‡å™ªå£°åæ–¹å·®
        
        # çŠ¶æ€å’Œåæ–¹å·®
        self.x = np.zeros(dim_x)  # çŠ¶æ€
        self.P = np.eye(dim_x)    # åæ–¹å·®
        
        # è®¡ç®—lambdaå’Œæƒé‡
        self._compute_weights()
    
    def _compute_weights(self):
        n = self.dim_x
        lam = self.alpha**2 * (n + self.kappa) - n
        self.lam = lam
        
        # è®¡ç®—æƒé‡
        self.Wm = np.zeros(2*n + 1)
        self.Wc = np.zeros(2*n + 1)
        
        self.Wm[0] = lam / (n + lam)
        self.Wc[0] = lam / (n + lam) + (1 - self.alpha**2 + self.beta)
        
        for i in range(1, 2*n + 1):
            self.Wm[i] = 1 / (2 * (n + lam))
            self.Wc[i] = 1 / (2 * (n + lam))
    
    def predict(self, u=None):
        # ç”Ÿæˆsigmaç‚¹
        sigma_points = self._generate_sigma_points()
        
        # ä¼ æ’­sigmaç‚¹
        n = self.dim_x
        sigma_points_pred = np.zeros((2*n + 1, n))
        
        for i in range(2*n + 1):
            sigma_points_pred[i] = self.fx(sigma_points[i], u, self.dt)
        
        # è®¡ç®—é¢„æµ‹å‡å€¼
        x_pred = np.zeros(n)
        for i in range(2*n + 1):
            x_pred += self.Wm[i] * sigma_points_pred[i]
        
        # è®¡ç®—é¢„æµ‹åæ–¹å·®
        P_pred = np.zeros((n, n))
        for i in range(2*n + 1):
            y = sigma_points_pred[i] - x_pred
            P_pred += self.Wc[i] * np.outer(y, y)
        
        P_pred += self.Q  # æ·»åŠ è¿‡ç¨‹å™ªå£°
        
        # ä¿å­˜ç»“æœ
        self.x = x_pred
        self.P = P_pred
        self.sigmas_f = sigma_points_pred
        
        return x_pred, P_pred
    
    def update(self, z):
        # ç”Ÿæˆç”¨äºè§‚æµ‹çš„sigmaç‚¹
        n = self.dim_x
        m = self.dim_z
        sigmas_f = self.sigmas_f
        
        # è®¡ç®—è§‚æµ‹é¢„æµ‹
        sigmas_h = np.zeros((2*n + 1, m))
        for i in range(2*n + 1):
            sigmas_h[i] = self.hx(sigmas_f[i])
        
        # è®¡ç®—é¢„æµ‹æµ‹é‡å‡å€¼
        z_pred = np.zeros(m)
        for i in range(2*n + 1):
            z_pred += self.Wm[i] * sigmas_h[i]
        
        # è®¡ç®—è§‚æµ‹åæ–¹å·®
        Pzz = np.zeros((m, m))
        for i in range(2*n + 1):
            y = sigmas_h[i] - z_pred
            Pzz += self.Wc[i] * np.outer(y, y)
        
        Pzz += self.R  # æ·»åŠ æµ‹é‡å™ªå£°
        
        # è®¡ç®—äº’åæ–¹å·®
        Pxz = np.zeros((n, m))
        for i in range(2*n + 1):
            dx = sigmas_f[i] - self.x
            dz = sigmas_h[i] - z_pred
            Pxz += self.Wc[i] * np.outer(dx, dz)
        
        # è®¡ç®—å¡å°”æ›¼å¢ç›Š
        K = Pxz @ np.linalg.inv(Pzz)
        
        # æ›´æ–°çŠ¶æ€
        self.x = self.x + K @ (z - z_pred)
        self.P = self.P - K @ Pzz @ K.T
        
        return self.x, self.P
    
    def _generate_sigma_points(self):
        n = self.dim_x
        sigma_points = np.zeros((2*n + 1, n))
        
        # è®¡ç®—çŸ©é˜µå¹³æ–¹æ ¹
        U = cholesky((n + self.lam) * self.P)
        
        # è®¾ç½®sigmaç‚¹
        sigma_points[0] = self.x
        
        for i in range(n):
            sigma_points[i+1] = self.x + U[i]
            sigma_points[i+n+1] = self.x - U[i]
        
        return sigma_points
```

ä½¿ç”¨ç¤ºä¾‹ï¼š

```python
# éçº¿æ€§ç³»ç»Ÿç¤ºä¾‹: è·Ÿè¸ªä¸€ä¸ªåšåŒ€é€Ÿåœ†å‘¨è¿åŠ¨çš„ç›®æ ‡
# çŠ¶æ€å‘é‡: [x, y, vx, vy]
# è§‚æµ‹å‘é‡: [r, Î¸] (è·ç¦»å’Œè§’åº¦)

import numpy as np
import matplotlib.pyplot as plt

def fx(x, u, dt):
    """çŠ¶æ€è½¬ç§»å‡½æ•°: åŒ€é€Ÿè¿åŠ¨æ¨¡å‹"""
    F = np.array([[1, 0, dt, 0],
                  [0, 1, 0, dt],
                  [0, 0, 1, 0],
                  [0, 0, 0, 1]])
    return F @ x

def hx(x):
    """è§‚æµ‹å‡½æ•°: æåæ ‡æµ‹é‡"""
    px, py = x[0], x[1]
    r = np.sqrt(px**2 + py**2)
    theta = np.arctan2(py, px)
    return np.array([r, theta])

# åˆå§‹åŒ–UKF
ukf = UnscentedKalmanFilter(dim_x=4, dim_z=2, dt=0.1, fx=fx, hx=hx)
ukf.x = np.array([0., 0., 1., 1.])  # åˆå§‹çŠ¶æ€
ukf.P *= 0.2                         # åˆå§‹åæ–¹å·®
ukf.R = np.diag([0.1, 0.05])         # æµ‹é‡å™ªå£°
ukf.Q = np.eye(4) * 0.01             # è¿‡ç¨‹å™ªå£°

# æ¨¡æ‹Ÿè¿è¡Œ
n_steps = 50
true_states = []
measurements = []
ukf_states = []

# çœŸå®çŠ¶æ€åˆå§‹åŒ–
true_x = np.array([0., 0., 1., 1.])

for i in range(n_steps):
    # æ›´æ–°çœŸå®çŠ¶æ€
    true_x = fx(true_x, None, 0.1)
    
    # ç”Ÿæˆå¸¦å™ªå£°çš„æµ‹é‡
    z = hx(true_x)
    z[0] += np.random.normal(0, 0.1)    # è·ç¦»æµ‹é‡å™ªå£°
    z[1] += np.random.normal(0, 0.05)   # è§’åº¦æµ‹é‡å™ªå£°
    
    # UKFé¢„æµ‹å’Œæ›´æ–°
    ukf.predict()
    ukf.update(z)
    
    # å­˜å‚¨æ•°æ®
    true_states.append(true_x.copy())
    measurements.append(z)
    ukf_states.append(ukf.x.copy())

# è½¬æ¢ä¸ºnumpyæ•°ç»„
true_states = np.array(true_states)
measurements = np.array(measurements)
ukf_states = np.array(ukf_states)

# æåæ ‡è½¬ç¬›å¡å°”åæ ‡
meas_x = measurements[:, 0] * np.cos(measurements[:, 1])
meas_y = measurements[:, 0] * np.sin(measurements[:, 1])

# ç»˜å›¾
plt.figure(figsize=(10, 6))
plt.plot(true_states[:, 0], true_states[:, 1], 'b-', label='çœŸå®è½¨è¿¹')
plt.plot(meas_x, meas_y, 'r.', label='æµ‹é‡å€¼')
plt.plot(ukf_states[:, 0], ukf_states[:, 1], 'g-', label='UKFä¼°è®¡')
plt.legend()
plt.grid(True)
plt.xlabel('Xä½ç½®')
plt.ylabel('Yä½ç½®')
plt.title('æ— è¿¹å¡å°”æ›¼æ»¤æ³¢å™¨è·Ÿè¸ªåœ†å‘¨è¿åŠ¨ç›®æ ‡')
plt.axis('equal')
plt.show()
```

</details>

## ä¸EKFæ¯”è¾ƒ

UKFå’ŒEKFéƒ½æ˜¯å¤„ç†éçº¿æ€§ç³»ç»Ÿçš„å¡å°”æ›¼æ»¤æ³¢æ‰©å±•ï¼Œä½†å®ƒä»¬é‡‡ç”¨ä¸åŒçš„æ–¹æ³•å¤„ç†éçº¿æ€§ï¼š

<div align="center">

| ç‰¹æ€§ | æ‰©å±•å¡å°”æ›¼æ»¤æ³¢ (EKF) | æ— è¿¹å¡å°”æ›¼æ»¤æ³¢ (UKF) |
|------|---------------------|---------------------|
| å¤„ç†éçº¿æ€§çš„æ–¹æ³• | å‡½æ•°çº¿æ€§åŒ–ï¼ˆæ³°å‹’å±•å¼€ï¼‰ | æ— è¿¹å˜æ¢ï¼ˆé‡‡æ ·ç‚¹ï¼‰ |
| å¯¼æ•°è®¡ç®— | éœ€è¦è®¡ç®—é›…å¯æ¯”çŸ©é˜µ | ä¸éœ€è¦è®¡ç®—å¯¼æ•° |
| ç²¾åº¦ | ä¸€é˜¶è¿‘ä¼¼ | è‡³å°‘äºŒé˜¶ç²¾åº¦ |
| è®¡ç®—å¤æ‚åº¦ | éšçŠ¶æ€ç»´åº¦çº¿æ€§å¢é•¿ | éšçŠ¶æ€ç»´åº¦å¹³æ–¹å¢é•¿ |
| é²æ£’æ€§ | å¯¹é«˜åº¦éçº¿æ€§ç³»ç»Ÿå¯èƒ½ä¸ç¨³å®š | å¯¹éçº¿æ€§æœ‰æ›´å¥½çš„é€‚åº”æ€§ |
| å®ç°éš¾åº¦ | éœ€è¦æ¨å¯¼é›…å¯æ¯”çŸ©é˜µ | æ— éœ€æ¨å¯¼å¯¼æ•°ï¼Œå®ç°ç®€å• |

</div>

<details>
<summary><b>ğŸ”„ EKFä¸UKFå¤„ç†éçº¿æ€§çš„æ–¹æ³•å¯¹æ¯”</b></summary>

![éœ€è¦æ’å…¥: EKFä¸UKFå¤„ç†éçº¿æ€§æ–¹æ³•å¯¹æ¯”å›¾]

**EKFçš„å¤„ç†æ–¹å¼**ï¼š
1. é€šè¿‡æ³°å‹’å±•å¼€åœ¨å·¥ä½œç‚¹é™„è¿‘çº¿æ€§åŒ–éçº¿æ€§å‡½æ•°
2. åªä¿ç•™ä¸€é˜¶é¡¹ï¼Œä¸¢å¼ƒé«˜é˜¶é¡¹
3. å°†çº¿æ€§åŒ–åçš„å‡½æ•°åº”ç”¨äºé«˜æ–¯åˆ†å¸ƒ

**UKFçš„å¤„ç†æ–¹å¼**ï¼š
1. é€šè¿‡sigmaç‚¹æ•è·è¾“å…¥åˆ†å¸ƒçš„ç»Ÿè®¡ç‰¹æ€§
2. å°†æ¯ä¸ªsigmaç‚¹ç›´æ¥é€šè¿‡éçº¿æ€§å‡½æ•°
3. ä»å˜æ¢åçš„sigmaç‚¹é‡å»ºè¾“å‡ºåˆ†å¸ƒ

UKFé€šè¿‡è¿™ç§æ–¹å¼é¿å…äº†çº¿æ€§åŒ–çš„è¯¯å·®ï¼Œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°æ•è·éçº¿æ€§å˜æ¢çš„å½±å“ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé«˜åº¦éçº¿æ€§ç³»ç»Ÿã€‚

</details>

## ä¼˜åŠ¿ä¸å±€é™æ€§

### ä¼˜åŠ¿

1. **æ— éœ€è®¡ç®—å¯¼æ•°** - ä¸éœ€è¦å¤æ‚çš„é›…å¯æ¯”çŸ©é˜µæ¨å¯¼
2. **æ›´é«˜çš„ç²¾åº¦** - æ•è·æ›´é«˜é˜¶çš„éçº¿æ€§æ•ˆåº”ï¼Œè‡³å°‘è¾¾åˆ°äºŒé˜¶ç²¾åº¦
3. **æ›´å¥½çš„ç¨³å®šæ€§** - å¯¹äºé«˜åº¦éçº¿æ€§ç³»ç»Ÿæ›´ç¨³å®šï¼Œä¸æ˜“å‘æ•£
4. **å®ç°ç®€å•** - æ— éœ€å¯¹ç³»ç»Ÿæ¨¡å‹è¿›è¡Œå¤æ‚çš„æ•°å­¦å¤„ç†
5. **æ•°å€¼ç¨³å¥æ€§** - å¯¹ä¸è¿ç»­æ€§å’Œå¼‚å¸¸æœ‰æ›´å¥½çš„å®¹å¿åº¦

### å±€é™æ€§

1. **è®¡ç®—å¤æ‚åº¦** - ä¸çŠ¶æ€ç»´åº¦çš„å¹³æ–¹æˆæ­£æ¯”ï¼Œé«˜ç»´çŠ¶æ€ç©ºé—´è®¡ç®—é‡å¤§
2. **å‚æ•°è°ƒæ•´** - éœ€è¦è°ƒæ•´alpha, beta, kappaç­‰å‚æ•°
3. **é«˜æ–¯å‡è®¾** - ä»ç„¶å‡è®¾å™ªå£°å’ŒçŠ¶æ€åˆ†å¸ƒä¸ºé«˜æ–¯åˆ†å¸ƒ
4. **ç¡®å®šæ€§é‡‡æ ·** - ä»…ä½¿ç”¨å°‘é‡ç¡®å®šæ€§æ ·æœ¬ç‚¹ï¼Œå¯èƒ½ä¸è¶³ä»¥è¡¨ç¤ºå¤æ‚åˆ†å¸ƒ
5. **å­˜å‚¨éœ€æ±‚** - éœ€è¦å­˜å‚¨å’Œå¤„ç†å¤šä¸ªsigmaç‚¹ï¼Œå†…å­˜éœ€æ±‚è¾ƒé«˜

## åº”ç”¨åœºæ™¯

UKFç‰¹åˆ«é€‚åˆä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š

<details>
<summary><b>ğŸŒ UKFå…¸å‹åº”ç”¨åœºæ™¯</b></summary>

1. **èˆªç©ºèˆªå¤©å¯¼èˆª**
   - å«æ˜Ÿè½¨é“ç¡®å®š
   - é£è¡Œå™¨å§¿æ€ä¼°è®¡
   - å†å…¥è½¨è¿¹é¢„æµ‹

2. **ç›®æ ‡è·Ÿè¸ª**
   - é›·è¾¾è·Ÿè¸ªéçº¿æ€§è¿åŠ¨ç›®æ ‡
   - å¤šä¼ æ„Ÿå™¨èåˆ
   - å¼¹é“å¯¼å¼¹è¿½è¸ª

3. **æœºå™¨äººå®šä½ä¸å¯¼èˆª**
   - åŒæ—¶å®šä½ä¸åœ°å›¾æ„å»º(SLAM)
   - ä¼ æ„Ÿå™¨èåˆå®šä½
   - ç§»åŠ¨æœºå™¨äººè·¯å¾„è§„åˆ’

4. **é‡‘èå¸‚åœºé¢„æµ‹**
   - è‚¡ç¥¨ä»·æ ¼é¢„æµ‹
   - é£é™©è¯„ä¼°
   - æœŸæƒå®šä»·

5. **ç³»ç»Ÿè¾¨è¯†**
   - éçº¿æ€§ç³»ç»Ÿå‚æ•°ä¼°è®¡
   - æ¨¡å‹æ ¡å‡†
   - æ•…éšœæ£€æµ‹

å¯¹äºè¿™äº›ç³»ç»Ÿï¼ŒUKFé€šå¸¸æ¯”EKFæä¾›æ›´å‡†ç¡®ã€æ›´ç¨³å®šçš„ä¼°è®¡ï¼Œå°¤å…¶æ˜¯å½“ç³»ç»Ÿå­˜åœ¨æ˜¾è‘—éçº¿æ€§æ—¶ã€‚

</details>

## æ€»ç»“

<div align="center">

**æ— è¿¹å¡å°”æ›¼æ»¤æ³¢ï¼šé€šè¿‡é‡‡æ ·ç­–ç•¥å·§å¦™å¤„ç†éçº¿æ€§é—®é¢˜çš„å¼ºå¤§å·¥å…·**

</div>

æ— è¿¹å¡å°”æ›¼æ»¤æ³¢æ˜¯ä¸€ç§å¼ºå¤§çš„éçº¿æ€§æ»¤æ³¢æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åˆ›æ–°çš„æ— è¿¹å˜æ¢æ–¹æ³•é¿å…äº†çº¿æ€§åŒ–å¸¦æ¥çš„è¯¯å·®ã€‚UKFåœ¨ä¿æŒå¡å°”æ›¼æ»¤æ³¢åŸºæœ¬æ¡†æ¶çš„åŒæ—¶ï¼Œé€šè¿‡sigmaç‚¹é‡‡æ ·æœ‰æ•ˆæ•è·éçº¿æ€§å˜æ¢çš„ç»Ÿè®¡ç‰¹æ€§ï¼Œä¸ºå¤„ç†å¤æ‚éçº¿æ€§ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªä¼˜é›…ä¸”é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚

ä¸EKFç›¸æ¯”ï¼ŒUKFå…·æœ‰å®ç°ç®€å•ã€æ— éœ€è®¡ç®—é›…å¯æ¯”çŸ©é˜µã€ç²¾åº¦æ›´é«˜ç­‰ä¼˜åŠ¿ï¼Œä½¿å…¶æˆä¸ºå¤„ç†ä¸­ç­‰å¤æ‚åº¦éçº¿æ€§ç³»ç»Ÿçš„é¦–é€‰æ–¹æ³•ã€‚å¯¹äºé«˜åº¦éçº¿æ€§æˆ–éé«˜æ–¯ç³»ç»Ÿï¼ŒUKFæä¾›äº†æ ‡å‡†å¡å°”æ›¼æ»¤æ³¢å’Œæ›´å¤æ‚çš„ç²’å­æ»¤æ³¢ä¹‹é—´çš„ä¸€ä¸ªè‰¯å¥½å¹³è¡¡ç‚¹ã€‚

---

[è¿”å›README](README.md) 