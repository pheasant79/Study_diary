# CAN总线基础知识

<div align="center">

![CAN总线](https://via.placeholder.com/600x150/0078D7/FFFFFF?text=CAN%E6%80%BB%E7%BA%BF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86)

</div>

---

## 📑 目录

- [CAN总线基础知识](#can总线基础知识)
  - [📑 目录](#-目录)
- [第一部分：CAN协议本身](#第一部分can协议本身)
  - [CAN总线基本概念](#can总线基本概念)
  - [CAN总线电平特性](#can总线电平特性)
  - [CAN总线协议帧类型](#can总线协议帧类型)
  - [CAN总线仲裁机制](#can总线仲裁机制)
  - [CAN总线错误处理](#can总线错误处理)
- [第二部分：STM32的CAN实现](#第二部分stm32的can实现)
  - [STM32 CAN控制器特点](#stm32-can控制器特点)
  - [STM32与CAN总线的连接方式](#stm32与can总线的连接方式)
  - [STM32 CAN过滤器配置](#stm32-can过滤器配置)
  - [STM32 CAN邮箱机制](#stm32-can邮箱机制)
  - [CAN总线的应用场景](#can总线的应用场景)
  - [常见问题](#常见问题)
  - [参考资料](#参考资料)
  - [位同步](#位同步)
  - [2-2 stm32 can外设下](#2-2-stm32-can外设下)
  - [C13-11单个设备环回测试\&三个设备互相通信](#c13-11单个设备环回测试三个设备互相通信)

---

# 第一部分：CAN协议本身

## CAN总线基本概念

<details>
<summary>📖 点击展开详细介绍</summary>

CAN总线（Controller Area Network）是一种差分信号通信协议，它与RS-232、RS-485、RS-422不同，不是串口通信(UART)的点对点通信，而是采用差分电平的多主机通信网络。

> 💡 **知识要点**: CAN总线是一种多主方式的串行通信总线，最初是由德国BOSCH公司为汽车行业开发的。

CAN协议的主要特点：
- 多主控制器网络
- 非破坏性总线仲裁
- 消息的优先级管理
- 多接收器广播通信
- 错误检测与错误处理机制
- 通信速度快（最高可达1Mbps）
- 抗干扰能力强，适合在汽车环境、恶劣电磁辐射环境中使用
- 可靠性高，具有完善的错误检测和处理机制

</details>

## CAN总线电平特性

<div class="can-levels" style="background-color:#f8f9fa;padding:15px;border-radius:5px;margin:10px 0;">

- **显性状态**（逻辑0）：
  - CAN_H = 3.5V
  - CAN_L = 1.5V
  - 差分电压约2V

- **隐性状态**（逻辑1）：
  - CAN_H ≈ CAN_L ≈ 2.5V
  - 差分电压约0V

```
     电压(V)
     ^
3.5V |    CAN_H (显性)
     |    *-----------*
     |    |           |
2.5V |----*           *----  CAN_H/CAN_L (隐性)
     |    |           |
     |    |           |
1.5V |    *-----------*      CAN_L (显性)
     |
     +----------------------> 时间
        隐性    显性    隐性
```

</div>

## CAN总线协议帧类型

<div style="overflow-x:auto;">

| 标准帧: | 起始位 | 仲裁场 (ID + RTR) | 控制场 (IDE + RTR + DLC) | 数据场 (0-8字节) | CRC场 (15位CRC + 分界符) | ACK场 | 结束符 | 帧间间隔 |
| :-------: | :------: | :----------------: | :----------------------: | :----------------: | :----------------------: | :-----: | :----: | :--------: |
| 扩展帧: | 起始位 | 仲裁场 (ID(29位) + RTR) | 控制场 (IDE + r1 + r0 + DLC) | 数据场 (0-8字节) | CRC场 (15位CRC + 分界符) | ACK场 | 结束符 | 帧间间隔 |

</div>

<details>
<summary>📋 各种帧类型的详细说明</summary>

- **数据帧**：用于发送节点向接收节点传送数据的帧
  ```
  +-----+--------+--------+------+-----+-----+-------+----------+
  |起始位|  仲裁场 |  控制场 | 数据场| CRC场| ACK场 | 结束符 | 帧间间隔 |
  +-----+--------+--------+------+-----+-----+-------+----------+
  ```

- **远程帧**：用于接收节点向具有相同ID的发送节点请求数据的帧
  - 与数据帧格式相同，但无数据场，且RTR位为隐性（1）

- **错误帧**：任何节点检测到总线错误时发送的帧
  - 由错误标志和错误界定符组成

- **过载帧**：接收节点通知它还没有准备好接收数据时发送的帧
  - 结构类似于错误帧

</details>

## CAN总线仲裁机制

<div class="arbitration" style="background-color:#fff8e1;padding:15px;border-radius:5px;border-left:5px solid #ffa000;margin:10px 0;">

CAN总线采用**CSMA/CD+AMP**（带有仲裁的载波侦听多路访问/冲突检测）机制：

1. 当总线空闲时，任何节点都可以发送消息
2. 当多个节点同时发送时，通过ID仲裁决定优先级：
   - ID值较低的节点获得总线访问权
   - 其他节点自动变为接收者，等待下一次机会
3. 这种仲裁过程是非破坏性的，不会影响总线效率

仲裁机制图示：
```
节点A (ID:15)  1 0 0 0 1 1 1 1... ←停止发送，变为接收者
节点B (ID:10)  1 0 1 0 1 0 1 0... ←继续发送，获得总线访问权
总线实际状态   1 0 0 0 1 0 1 0...
                     ↑
                 仲裁点(显性胜出)
```

注：CAN总线上的显性状态（0）会覆盖隐性状态（1）

</div>

## CAN总线错误处理

<details>
<summary>🔍 CAN总线错误检测与处理机制</summary>

CAN协议定义了5种错误检测机制：

1. **位错误**：节点发送位后监听总线，若检测到的值与发送值不同（非仲裁期间），则报错
2. **填充错误**：连续5个相同位后，发送方自动插入一个相反值位，接收方检测不符合此规则时报错
3. **CRC错误**：接收方计算的CRC与发送方提供的不一致时报错
4. **帧格式错误**：收到的帧在固定格式字段有错误时报错
5. **应答错误**：发送方在ACK槽没有检测到显性位时报错

**错误处理流程**：
1. 检测到错误的节点发送错误帧
2. 其他节点检测到错误帧也发送错误帧
3. 原始消息被丢弃，发送方尝试重新发送

**错误计数与错误状态**：
- 每个节点维护发送错误计数器(TEC)和接收错误计数器(REC)
- 根据计数值，节点可处于三种状态：
  - **错误活动**：0-127，正常参与总线通信
  - **错误被动**：128-255，仍可通信但有限制
  - **总线关闭**：>255，节点自动从总线断开

</details>

---

# 第二部分：STM32的CAN实现

## STM32 CAN控制器特点

<div class="stm32-features" style="background-color:#e8f4ff;padding:15px;border-radius:5px;border-left:5px solid #0078D7;margin:10px 0;">

STM32的CAN控制器集成了以下特性：
- 完全符合CAN协议2.0A和2.0B（主动）
- 位时序可编程
- 三个发送邮箱
- 两个接收FIFO，每个可存储3条消息
- 高级筛选器组，最多28个过滤器
- 中断功能：发送完成、接收FIFO、错误等
- 支持时间触发通信模式
- 支持睡眠模式和唤醒功能

</div>

## STM32与CAN总线的连接方式

STM32与CAN总线之间是通过CAN总线收发器连接的。收发器的作用是：
1. 将单片机发出的数字信号(0和1)转换为CAN总线上的差分信号(CAN-H和CAN-L)
2. 将CAN总线上的差分信号转换为单片机能够识别的数字信号(0和1)

```
+----------+          +------------+          +-----------+
|          |   TXD    |            |  CAN_H   |           |
|  STM32   |--------->| CAN收发器  |--------->|  CAN总线  |
| 控制器   |   RXD    |            |  CAN_L   |           |
|          |<---------|            |<---------|           |
+----------+          +------------+          +-----------+
```

STM32只需要两个引脚即可与CAN收发器通信：
- **TXD**：发送引脚，输出0和1信号，经过收发器转换为CAN总线上的差分信号
- **RXD**：接收引脚，CAN总线的差分信号经过收发器转换后输入到此引脚

## STM32 CAN过滤器配置

<details>
<summary>📊 STM32 CAN消息过滤器配置详解</summary>

STM32的CAN控制器具有强大的硬件过滤器功能，可以过滤不需要的消息，减轻CPU负担：

**过滤器特性**：
- 最多可配置28个过滤器组（根据STM32型号有所不同）
- 支持标识符掩码模式和标识符列表模式
- 支持标准帧ID和扩展帧ID
- 每个过滤器可独立分配到接收FIFO0或FIFO1

**过滤器模式**：
1. **掩码模式**：通过设置掩码位决定哪些ID位参与比较
   ```
   消息ID:  1 0 1 0 1 0 1 0
   过滤器ID: 1 0 1 0 0 0 0 0
   掩码:    1 1 1 1 0 0 0 0  (1=必须匹配，0=忽略)
   结果: 匹配 (因为前4位相同)
   ```

2. **列表模式**：直接比较消息ID与列表中的ID
   ```
   列表ID1: 0x123
   列表ID2: 0x456
   收到消息ID: 0x123 -> 匹配
   收到消息ID: 0x789 -> 不匹配
   ```

**过滤器初始化步骤**：
1. 退出过滤器初始化模式
2. 配置过滤器的模式、规模、ID值和掩码值
3. 指定过滤器的FIFO分配
4. 激活过滤器
5. 退出过滤器初始化模式

</details>

## STM32 CAN邮箱机制

<div class="mailbox" style="background-color:#f0f4c3;padding:15px;border-radius:5px;border-left:5px solid #afb42b;margin:10px 0;">

STM32的CAN控制器采用邮箱机制管理消息传输：

**发送邮箱**：
- 共有3个发送邮箱，可以同时准备3条待发送消息
- 发送优先级由两个因素决定：
  1. 邮箱优先级（可配置）
  2. 消息标识符优先级（ID较小优先级更高）
- 当总线空闲时，优先级最高的邮箱消息将被发送

**接收FIFO**：
- 两个接收FIFO，每个可存储3条消息
- 通过过滤器组指定消息到特定FIFO
- 接收中断可针对特定FIFO进行配置
- 溢出处理：可配置为覆盖旧消息或锁定FIFO

</div>

---

## CAN总线的应用场景

<div class="applications" style="display:flex;flex-wrap:wrap;justify-content:space-around;text-align:center;margin:20px 0;">

<div style="width:150px;margin:10px;padding:15px;background-color:#f0f0f0;border-radius:8px;">
📱<br>汽车内部网络通信
</div>

<div style="width:150px;margin:10px;padding:15px;background-color:#f0f0f0;border-radius:8px;">
🏭<br>工业自动化控制系统
</div>

<div style="width:150px;margin:10px;padding:15px;background-color:#f0f0f0;border-radius:8px;">
🏥<br>医疗设备
</div>

<div style="width:150px;margin:10px;padding:15px;background-color:#f0f0f0;border-radius:8px;">
🏢<br>智能建筑
</div>

<div style="width:150px;margin:10px;padding:15px;background-color:#f0f0f0;border-radius:8px;">
✈️<br>航空电子设备
</div>

</div>

---

## 常见问题

<details>
<summary>CAN总线的最大通信距离是多少？</summary>

CAN总线的通信距离与波特率相关：
- 1Mbps：最大距离约40米
- 500kbps：最大距离约100米
- 125kbps：最大距离约500米
- 10kbps：最大距离可达几公里

通信距离还受到总线拓扑结构、终端电阻和电缆质量的影响。
</details>

<details>
<summary>CAN总线需要终端电阻吗？</summary>

是的，CAN总线两端需要120Ω的终端电阻以防止信号反射。在高速CAN网络中，这些电阻连接在CAN_H和CAN_L线之间。
</details>

<details>
<summary>CAN总线如何处理冲突？</summary>

CAN总线使用CSMA/CD+AMP（带有仲裁的载波侦听多路访问/冲突检测）机制处理冲突。当多个节点同时发送时，通过ID仲裁决定优先级，ID值较低的节点获得总线访问权。
</details>

<details>
<summary>STM32的CAN控制器如何实现数据过滤？</summary>

STM32的CAN控制器内置硬件过滤器，可通过标识符过滤消息。支持掩码模式和列表模式，最多可配置28个过滤器。过滤器可分配到两个不同的接收FIFO。
</details>

---

## 参考资料

- [BOSCH CAN规范 2.0](https://www.bosch-semiconductors.com/media/ip_modules/pdf_2/can_literature_and_more/can_specification_2_0.pdf)
- [ISO 11898 标准](https://www.iso.org/standard/63648.html)
- [STM32 CAN外设应用指南](https://www.st.com/resource/en/application_note/an4230-can-protocol-used-in-the-stm32-bootloader-stmicroelectronics.pdf)
- [STM32参考手册 - CAN控制器章节](https://www.st.com/resource/en/reference_manual/dm00031020-stm32f405-415-stm32f407-417-stm32f427-437-and-stm32f429-439-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)

---

<div align="center">
<p style="color:#888;">最后更新: 2023年12月</p>
</div>



CAN总线的基本概念、特性及应用，详细讲解了其硬件电
路、数据帧格式、接收方处理方式、错误处理以及多设备同
时发送的处理方法。重点学习了高速CAN总线的电路接法，
包括每个设备通过CAN收发器挂载在CAN总线上，CAN控制
器引出的TX和RX与CAN收发器相连，CAN收发器的CANH
和CANL直接与总线相连。同时，讲解了高速CAN使用闭环
网络的接法，即在CAN总线的两端添加120欧的终端电阻。
视频还简单介绍了CAN收发器的内部结构及其功能，以及C
AN总线的物理层特性，包括最高传输速率、最长传输距
离、最大节点数量以及电压定义等。此外，视频还讲解了CA
N总线的数据传输格式，即如何连续发送多位数据，以及如
何编码和解析数据。

#CAN总线入门教程，全面细致讲解，多机通信实
践。

期视频将带大家从理论到实践，学习CAN总
线的各个知识点，最终实现CAN总线通信实验。

7第一部分介绍CAN协议的各项规定；第二部分介
绍STM32的CAN外设；第三部分是代码编写过
程。

6理论结合实践，完全掌握CAN总线就不是问题。

#CAN总线入门，多机通信，高速看应用广

1传输距离小于1000米，高速传输快但距离短,
低速传输慢但距离远，选择依据应用场景。

看总线是多设备通信，半双工，无需线，通讯速
率由设备约定，多设备同时发送通过仲裁判断先
后。

7看总线数据帧可配置1-8字节有效载荷，强大于
一次发一个字节的串口，灵活指定数据长度。

#CAN总线物理层与数据传输原理解析。

[防止回波反射，确保信号稳定传输；终端电阻还
能在无设备操作时收紧差分线电压。

0收发器有超时计时器，防止设备异常拽着总线不
放导致总线瘫痪。

如果TXT给一，总线呈现默认的隐形电平一；如
果TXT给零，输出显性电平零；如果TXT一直给
零出错，收发器会主动释放总线

-----------------------------------------------
CAN总线的基本概念和操作流程，包括发送方和接收方的操
作流程，以及总线的释放和回归状态。详细解析了数据帧的
结构和功能，包括ID、RTR、IDE、SR、RO、R1、DLC、Da
ta、CRC、ACK等部分的作用。同时，介绍了数据帧的发展
历史，以及遥控帧的使用场景。此外，还讲解了数据帧和遥
控帧的时序定义，包括未填充规则及其作用。未填充规则规
定，每发送五个相同电瓶后，自动追加一个相反电瓶的填充
位，以防止数据波形长时间不变化，影响接收方的准确接 
收。同时，未填充还增加了波形的定时信息，利于接收方执
行再同步，防止波形长时间无变化导致接收方不能精确掌握
数据采样时机。最后，强调了所有设备必须遵守CAN协议的
规定，以确保波形的正确理解和使用。

#CAN总线数据帧格式详解，包括标准与扩展格式。


介绍了总线真格式，包括数据帧、遥控帧、错误
帧和帧间隔，重点讲解了数据帧的格式和用途。


细分析了数据帧的标准格式，包括显性电平和
隐性电平的定义，以及数据帧的各个部分的作用
和含义。

6解释了数据帧的标准格式和扩展格式的区别，以
及数据帧的各个部分的具体含义和作用。

#CAN总线入门，多机通信，详细教学。
AN总线发送方与接收方的交互机制，发送方在
发送完数据后释放总线，接收方在接收到数据后
应答，确认数据传输成功。

2发送方通过读取总线的状态来判断数据是否被正
确接收，接收方在ACK槽位主动拉开总线，发送
方读取为显性零则数据传输成功。

7在ACK槽位，总线的操作权从发送方转移到接收
方，接收方在ACK槽位释放总线，发送方读取总
线状态来判断数据传输状态。

#未填充规则确保数据传输准确，接收方移除填充位
恢复原始数据。
1如果没有及时发射数据或数据使用频率太低，广
播太频繁或太慢，可以使用请求-响应机制，接
收方发出遥控帧，发送方通过数据帧响应。

4使用频率高的数据，可以直接使用广播式发送，
不需要请求-响应机制。

主动错误标志为显性，被动错误标志为隐性，主
动错误标志会破坏正常传输的数据，被动错误标
志不会破坏其他设备的数据。

未填充规则确保数据传输准确，防止波形长时间不
变化。

3接收的数据与发送一致，就是无填充规则，未填
充是发送方的最后一步，接收方的第一步

未填充的作用是增加波形的定时信息，利于接收
方执行再同步，防止波形长时间无变化

未填充的作用是保持看总线在发送正常数据流时
的活跃状态，防止被误认为总线空闲

#CAN总线波形解析与数据传输原理。

介绍CAN总线数据帧结构，数据段长度可变，最
长8字节。

1扩展数据帧的波形，29位ID号范围。

接收方采样步骤和硬件设计，解决时间问题。

-------------------------------------------------
位同步
----------------------------------------------
CAN总线的资源分配和仲裁规则。首先，强调了在多设备同
时发送时的冲突解决，通过先占先得的规则确保同一时间只
有一个设备操作总线发送数据。引入了非破坏性仲裁规则，
基于ID号的大小来决定优先级，确保重要消息优先发送。接
着，CAN总线的基本特性，包括限与特性和回读机制，详细
解释了非破坏性仲裁过程。最后，探讨了数据帧和遥控帧的
优先级，以及标准格式和扩展格式的优先级，强调了CAN总
线设计上的完美闭环，确保了其稳定性。

#看总线资源分配规则：先占先得与非破坏性仲裁。
1总线资源分配规则：解决多设备同时发送的问
题，包括先占先得规则和非破坏性仲裁。

资源分配规则一：先占先得，一个设备开始发送
后，其他设备不能中途打断。

资源分配规则二：非破坏性仲裁，多个设备同时
发送时，根据ID号进行仲裁，ID小的优先

#CAN总线仲裁规则：ID小优先级高，冲突时小ID胜
出。
仲裁失败后，设备会转入接收状态，等待下一次
总线空闲时再尝试发送。ID号不是随意分配的，
重要消息的ID号通常较小，以确保在产生仲裁时
能够优先发送。

限与特性和回读机制。限与特性是指总线上任何
一个设备发送显性电平零时，总线会呈现显性电
平零状态。回读机制是指每个设备发出一个数据
位后，都会读回总线当前的电平状态，以确认自
己发出的电平是否被真实发送出去。

仲裁过程是通过数据位从前到后依次比较，出现
差异且数据位为1的设备进行仲裁。设备在仲裁
段发一位读回一位，只有发出的数据和读回的数
据一样才会继续发送。在仲裁段一旦出现发出的
数据和读回的不一样，设备就会退出，让其他设
备继续发送。

#CAN总线仲裁规则详解，非破坏性，优先级判定。
每隔五位会插入一个实际的11位ID，ID会变成1
3位，不会导致仲裁出错或优先级变化。

仲裁过程称为非破坏性，胜利者不受影响，失败
者会退出。

数据帧优先级高于遥控帧，相同ID时适用；标准
格式优先级高于扩展格式。

----------------------------------------------------
CAN总线在错误处理方面的详细机制，包括五种错误类型及
其检测范围。同时，引I入了错误状态机制，通过TEC和REC
计数器评定设备状态。接着，讲解了错误计数器的工作原理
及其在多机通信中的应用，通过面包板教学展示了错误帧的
波形现象。随后，全面细致地解析了CAN总线的错误帧波
形，强调了被动错误设备的仲裁机制，并介绍了CAN总线协
议的理论知识。最后，预告了下一阶段的实验，即通过STM
32实现多个设备间的数据传输。

#看总线错误处理机制，五种错误类型，错误通知与
错误状态管理。
Z本课程第五章主题是错误处理，看总线额外安全
机制，设备检测帧传输出错可主动发出错误帧通
知其他设备，避免错误数据被使用。

看总线在干扰强地方，数据位传输易出错，错误
处理设计重要，确保后续操作正常进行。

01:42未错误、填充错误、CRC错误、格式错误、应答
错误，每种错误检测范围和检测单元不同。

#CAN总线错误状态与计数器变化详解。

0错误检测频率反映设备可靠性，TEC和REC值变
化指示设备状态
10:18设备错误状态定义其可靠性，TEC/IC超限转入被
动/关闭状态
11:50关闭设备后可恢复，连续11个隐性位使设备重回
主动状态

#CAN总线入门教程，多机通信与错误帧分析。
0总结CAN总线理论知识，强调实践的重要性，建
议进一步阅读相关手册。
23:33介绍看总线入门书和看总线协议V2.0手册的内
容，指出看2.0可以兼容旧版本。
26:13提到看收发器芯片的说明手册，强调其对于电路
设计的重要性。

--------------------------------
CAN总线入门教程的全面细致讲解。首先，视频详细解析了
STM32F103C8T6芯片内部的CAN外设原理，包括最高波特
率、发送和接收缓存区的配置、过滤器的使用等。接着，视
频通过面包板教学，深入分析了CAN总线多机通信的实现，
重点介绍了收发器模块的原理图及实物照片，明确了终端电
阻的作用及设置方法。然后，视频详细讲解了CAN总线接收
与发送的具体流程，包括过滤器的作用、接收队列的排队机
制，以及发送队列的工作流程和状态流转。最后，视频深入
解析了发送邮箱和接收邮箱的状态流程及配置位的详细配置
策略，使得CAN总线的使用更加灵活和方便。

#STM32看外设入门教程，详细讲解硬件原理与通
信。

欢迎继续观看看总线入门教程，即将进入第二部
分，讲解STM32看外设。
00:15通过前五节课的学习，大家对看总线有了基本了
解，接下来将通过实践验证所学知识。
00:29本节课的内容来源于STM32手册，包括看外设的
介绍和相关资料，帮助大家更深入理解。

#CAN总线原理及STM32操作详解。

个元件的主要目的是过滤噪声，提高波形平滑
度，但具体效果不确定。设计模块的人可能根据
经验添加这些电路板，自己设计时可加可不加。
10:13每个收发器模块自带终端电阻，两个模块相连时
终端电阻为两个，三个或更多模块相连时需去掉
中间模块的终端电阻以符合协议。
10:44实验中未去掉终端电阻，三个设备互相通信时加
三个终端电阻也没问题，但实际项目中需严格按
照协议要求。

#CAN总线发送与接收流程详解。

5先请求先发送，按ID号优先级处理多个报文
20:25总线接收的报文通过过滤器进行筛选，过滤器可
配置，实现特定报文接收
21:4014个过滤器可配置，实现多种报文筛选，节省软
件处理时间

#CAN总线发送与接收状态及配置详解。

XRQ等于一表示发送请求，邮箱进入挂号状
态，请求完成、发送成功和邮箱空状态变化。
30:30优先级决定方式：请求次序和报文ID大小，影响
邮箱发送顺序。
31:27发送失败后，NART决定是否自动重发，失败后
状态和请求完成、发送成功、邮箱空状态变化。
32:05预定或挂号状态时，ABRQ可终止发送，状态和
请求完成、发送成功、邮箱空状态变化。
8接收基本流程：接收报文，匹配过滤器，进入fin
al状态，CPU读取。
33:07final状态流程：报文数目和状态变化，最大排队
三个报文，溢出标志位。
34:33释放后状态变化，队伍长度减少。
35:57NART：禁止自动重传，报文只发一次，失败不
重发。
36:39TXFP：发送优先级配置，决定发送顺序。

FRFLM：接收file锁定模式，决定溢出时新报文处
理策略。
37:59配置发送和接收参数，根据需求灵活使用。

--------------------------------------------
2-2 stm32 can外设下
--------------------------------------------
C13-11单个设备环回测试&三个设备互相通信
-----------------------------------------
CAN总线入门教程的全面细致讲解。首先，介绍了如何改造
发送和接收函数以接受结构体参数，简化了代码的复杂性。
接着，通过实例验证了标识符过滤器的力能，展示了如何配
置过滤器以接收特定ID的CAN帧。然后，，详细讲解了如何便
用结构体进行多机通信，包括定义和初始化结构体，以及发
天和接收不同类型的CA门顺。此外，还介绍了如何通过过源
器实现特定ID的接收，并展示了如何配置多个过滤器以接收
更多的目标ID。最后，讲解了CAN总线标识符过滤器的多种
模式及应用，包括16位列表模式、16位屏蔽模式、32位列
表模式和32位屏蔽模式的配置和使用。通过实验，验证了过
滤器的正确性，并实现了只接收遥控帧或只接收数据帧的功
能。

#CAN总线入门教程，详细讲解代码实现与过滤器验
证。
00:01I本节课程继续学习CAN的代码部分，上节课学
习了单个设备环回测试和三个设备互相通信。
00:30本节将实现完整功能的代码，包括标准格式、扩
展格式数据帧和遥控帧。
01:04本节代码将验证标识符过滤器的功能，包括16位
列表和16位屏蔽。

#CAN总线结构体定义与应用详解。
10:00定义结构体并初始化，指定成员赋值
10:12使用结构体定义同时赋初值，支持指定成员赋值
10:28修改代码使用结构体发送和接收数据，区分标准
和扩展格式

#CAN总线过滤器测试成功。
20:001介绍如何修改测试数据，包括标准数据帧和扩展
数据帧的设置
23:20演示如何进行不同设备之间的通信，包括发送和
接收数据的过程
25:26角解释如何在不同设备之间进行通信，强调不同设
备不能发送相同ID的帧

#CAN总线多机通信与过滤器配置实验。
30:01目前第一个设备处于回传模式，只接收部分报
文，第二个设备处于静默模式，接收所有报文。
第一个设备发出的报文也会广播到总线，被其他
设备接收。
30:27演示了第一个设备和第二个设备之间的通信，包
括报文的发送和接收。
33:50演示了如何将发送和接收功能放在不同的设备
中，并进行了相应的配置和测试。

#CAN总线标识符过滤器配置与测试。
40:00回到工程文件夹，继续下一个实验，复制零四的
工程，改名为零六，标识符过滤器32位列表
41:06配置过滤器，使用32位列表模式，设置id和mas
k，测试接收123和12345678的扩展帧
44:26开始下一个代码，复制零六的工程，改名为零
七，标识符过滤器32位屏蔽，实现第四行示例

-----------------------------------------------
CAN总线的中断式接收、数据传输策略、传输策略、面包板
教学及多机通信。首先，介绍了中断配置的流程和注意事
项，包括使用NVIC配置中断优先级和响应优先级。然后，通
过编写中断函数，实现了对CAN接收数据的处理。接看，讲
解了如何在主函数中接收并处理接收到的数据。此外，还提
到了CAN总线除了用于接收数据外，发送邮箱空、接收满、
溢出及错误和状态改变等也可以触发中断。然后，详细讲解
了定时传输、触发传输和请求传输三种策略。其中，定时传
输由发送方定时广播数据，接收方无需请求；触发传输由发
送方根据内部条件主动广播数据；请求传输由接收方发起请
求，发送方响应。通过实例演示了定时传输、触发发送和请
求传输。接着，讲解了如何进行多机通信。通过面包板教
学，展示了请求发送和接收的过程。首先，定义了请求标
志，并在主循环中接收请求帧，判断其ID，设置请求标志。
接着，发送方根据请求标志发送相应的数据帧。同时，介绍
了上层协议的重要性，以及如何遵循标准协议进行设备整
合。最后，强调了学习主流上层协议的必要性。

#CAN总线入门教程，多机通信，中断式接收与数据
传输策略。
00:01零九中断式接收和么零数据传输策略。
00:29零九程序关键在于中断配置，使用FMPO中断接
收数据，并在中断函数中处理数据。
01:41中断接收的优势在于处理多帧数据，通过中断可
以更方便地处理大量数据。

#CAN总线中断配置及接收数据流程。
10:01在中断程序中，可以使用NVIC分组配置，选择
合适的中断通道。
10:16中断通道的选择非常重要，必须与硬件匹配，否
则无法接收信号。
10:50中断函数的命名需要准确，可以从启动文件中复
制，确保无误。

#CAN总线数据传输策略及实现。
20:00本节介绍CAN总线数据传输策略，包括定时传
输、触发传输和请求传输。
20:47数据传输策略主要解决数据发送方和接收方的协
调问题，确保数据的有效传输。
23:57请求传输适合接收方偶尔有请求才需要的数据，
比如调试接口。

#CAN总线触发发送与定时发送代码实现。
30:02接收代码完成，显示接收到的信息
30:32接收到定时数据，显示接收到的数据
31:30测试成功，发送和接收数据一致
32:04完成定时传输实验
32:161改变环回模式为正常模式
32:34使用定时器实现定时发送，避免主循环阻塞
36:28定时传输注意总线资源占用，避免高优先级帧占
用过多资源
37:11开始触发发送，使用按键模拟触发信号
38:35完成触发发送的逻辑，按键触发发送数据帧
39:17测试触发发送成功，接收方未接收到数据
39:50按键按下阻塞问题后续解决，暂时不处理

#CAN总线多机通信实现及三种传输策略演示。
40:01接收部分的代码编写，接收触发数据帧并显示在
OID第三行
40:42角触发传输只在需要时发送数据
41:24请求传输的实现步骤：接收指定请求的帧，设置
请求标志位，根据标志位发送对应数据帧

#CAN总线入门：上层协议与标准整合。
50:01上层协议定义ID分配和数据段内容
50:27大项目需遵循标准协议（如CANOpen)
51:13了解主流上层协议利于项目整合与再开发