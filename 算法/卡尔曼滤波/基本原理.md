# 卡尔曼滤波基本原理

<div align="center">

![需要插入: 卡尔曼滤波工作原理流程图]

</div>

## 目录

- [基本概念](#基本概念)
- [卡尔曼滤波的数学模型](#卡尔曼滤波的数学模型)
- [滤波过程](#滤波过程)
- [算法推导](#算法推导)
- [参数说明](#参数说明)
- [一维示例](#一维示例)
- [总结](#总结)

## 基本概念

卡尔曼滤波是一种递归的状态估计算法，它通过结合系统模型预测和观测数据来估计动态系统的状态。

<details>
<summary><b>📚 历史背景</b></summary>

卡尔曼滤波器由匈牙利数学家鲁道夫·卡尔曼（Rudolf Emil Kalman）于1960年提出，最初是为了解决阿波罗计划中的导航问题。在阿波罗11号登月任务中，卡尔曼滤波器被成功应用于飞船导航系统，帮助宇航员准确到达月球表面。

经过几十年的发展，卡尔曼滤波已经成为信号处理、导航、控制和机器人领域的基础算法之一。

</details>

卡尔曼滤波的基本思想是：**融合不完美的预测和不完美的测量，得到对真实状态的最佳估计**。

## 卡尔曼滤波的数学模型

卡尔曼滤波基于两个基本模型：

1. **状态转移模型（预测模型）**：描述系统如何从一个状态转移到下一个状态
2. **观测模型（测量模型）**：描述如何从系统状态获得测量值

### 状态转移模型

<div align="center">

$\mathbf{x}_k = \mathbf{F}_k \mathbf{x}_{k-1} + \mathbf{B}_k \mathbf{u}_k + \mathbf{w}_k$

</div>

其中：
- $\mathbf{x}_k$ 是时刻 $k$ 的系统状态向量
- $\mathbf{F}_k$ 是状态转移矩阵，描述系统的动态特性
- $\mathbf{B}_k$ 是控制输入矩阵
- $\mathbf{u}_k$ 是控制输入向量
- $\mathbf{w}_k$ 是过程噪声，假设为均值为零的高斯白噪声，协方差为 $\mathbf{Q}_k$

### 观测模型

<div align="center">

$\mathbf{z}_k = \mathbf{H}_k \mathbf{x}_k + \mathbf{v}_k$

</div>

其中：
- $\mathbf{z}_k$ 是时刻 $k$ 的观测向量
- $\mathbf{H}_k$ 是观测矩阵，将状态空间映射到观测空间
- $\mathbf{v}_k$ 是测量噪声，假设为均值为零的高斯白噪声，协方差为 $\mathbf{R}_k$

## 滤波过程

卡尔曼滤波算法是一个两步迭代过程：**预测**和**更新**。

<details>
<summary><b>🔄 卡尔曼滤波循环图</b></summary>

```
┌───────────────┐     ┌──────────────┐
│ 初始状态估计   │     │  预测阶段     │
│ x₀ 和 P₀      │────►│ 计算先验估计   │
└───────────────┘     │ x̂ₖ⁻ 和 Pₖ⁻    │
                      └──────┬───────┘
                             │
                             ▼
┌───────────────┐     ┌──────────────┐
│ 下一时间步     │◄────│  更新阶段     │
│ k = k+1       │     │ 计算后验估计   │
└───────────────┘     │ x̂ₖ 和 Pₖ      │
                      └──────▲───────┘
                             │
                      ┌──────┴───────┐
                      │  测量值 zₖ    │
                      └──────────────┘
```

</details>

### 预测步骤

在预测步骤中，卡尔曼滤波器使用上一时刻的状态估计和系统模型预测当前时刻的状态：

1. **预测状态**：
   <div align="center">
   $\hat{\mathbf{x}}_{k|k-1} = \mathbf{F}_k \hat{\mathbf{x}}_{k-1|k-1} + \mathbf{B}_k \mathbf{u}_k$
   </div>

2. **预测误差协方差**：
   <div align="center">
   $\mathbf{P}_{k|k-1} = \mathbf{F}_k \mathbf{P}_{k-1|k-1} \mathbf{F}_k^T + \mathbf{Q}_k$
   </div>

### 更新步骤

在更新步骤中，卡尔曼滤波器利用当前测量值修正预测结果：

1. **计算卡尔曼增益**：
   <div align="center">
   $\mathbf{K}_k = \mathbf{P}_{k|k-1} \mathbf{H}_k^T (\mathbf{H}_k \mathbf{P}_{k|k-1} \mathbf{H}_k^T + \mathbf{R}_k)^{-1}$
   </div>

2. **更新状态估计**：
   <div align="center">
   $\hat{\mathbf{x}}_{k|k} = \hat{\mathbf{x}}_{k|k-1} + \mathbf{K}_k (\mathbf{z}_k - \mathbf{H}_k \hat{\mathbf{x}}_{k|k-1})$
   </div>

3. **更新误差协方差**：
   <div align="center">
   $\mathbf{P}_{k|k} = (\mathbf{I} - \mathbf{K}_k \mathbf{H}_k) \mathbf{P}_{k|k-1}$
   </div>

<details>
<summary><b>✨ 卡尔曼增益的含义</b></summary>

卡尔曼增益 $\mathbf{K}_k$ 决定了算法对新测量值的信任程度。它是一个权衡因子，在预测值和测量值之间进行平衡：

- 当测量噪声 $\mathbf{R}_k$ 较小时，卡尔曼增益较大，算法更信任测量值
- 当预测误差协方差 $\mathbf{P}_{k|k-1}$ 较小时，卡尔曼增益较小，算法更信任预测值

卡尔曼增益的计算旨在最小化估计误差的方差，使得更新后的状态估计是最优的（在线性高斯假设下）。

</details>

## 算法推导

<details>
<summary><b>🧮 贝叶斯视角下的卡尔曼滤波</b></summary>

从贝叶斯估计的角度看，卡尔曼滤波是一种特殊的贝叶斯滤波器，专门用于线性高斯系统。在贝叶斯框架下：

1. **先验分布** $p(\mathbf{x}_k|\mathbf{z}_{1:k-1})$ 对应预测步骤
2. **后验分布** $p(\mathbf{x}_k|\mathbf{z}_{1:k})$ 对应更新步骤

对于线性高斯系统，这些分布都是高斯分布，可以用均值向量和协方差矩阵完全表示。卡尔曼滤波正是利用了这一特性，通过递归方式高效地计算这些分布的参数。

```
先验分布: 𝒩(x̂ₖ⁻, Pₖ⁻) ∝ exp(-½(xₖ-x̂ₖ⁻)ᵀ(Pₖ⁻)⁻¹(xₖ-x̂ₖ⁻))
似然函数: 𝒩(zₖ; Hₖxₖ, Rₖ) ∝ exp(-½(zₖ-Hₖxₖ)ᵀRₖ⁻¹(zₖ-Hₖxₖ))
后验分布: 𝒩(x̂ₖ, Pₖ) ∝ 𝒩(x̂ₖ⁻, Pₖ⁻) × 𝒩(zₖ; Hₖxₖ, Rₖ)
```

通过对先验分布和似然函数的乘积进行分析，可以导出卡尔曼滤波的更新方程。

</details>

卡尔曼滤波器的最优性基于以下假设：

1. 系统是线性的
2. 过程噪声和测量噪声都是高斯白噪声
3. 噪声的协方差矩阵已知

在这些假设下，卡尔曼滤波提供的是最小均方误差（MMSE）估计。

## 参数说明

<details open>
<summary><b>📊 卡尔曼滤波参数详解</b></summary>

| 参数 | 符号 | 描述 | 获取方法 |
|------|------|------|----------|
| 状态转移矩阵 | $\mathbf{F}_k$ | 描述系统如何从一个状态转移到下一个状态 | 物理模型或系统辨识 |
| 控制输入矩阵 | $\mathbf{B}_k$ | 描述控制输入如何影响系统状态 | 物理模型 |
| 过程噪声协方差 | $\mathbf{Q}_k$ | 表示系统模型的不确定性 | 系统分析或调优 |
| 观测矩阵 | $\mathbf{H}_k$ | 将状态空间映射到观测空间 | 传感器模型 |
| 测量噪声协方差 | $\mathbf{R}_k$ | 表示测量的不确定性 | 传感器规格或实验测定 |
| 初始状态估计 | $\hat{\mathbf{x}}_{0|0}$ | 系统初始状态的估计 | 先验知识或初始测量 |
| 初始误差协方差 | $\mathbf{P}_{0|0}$ | 初始状态估计的不确定性 | 根据初始估计的置信度设置 |

</details>

这些参数对卡尔曼滤波器的性能至关重要。错误的参数设置可能导致滤波器性能下降，甚至发散。

## 一维示例

<details>
<summary><b>🔢 一维位置跟踪示例</b></summary>

考虑一维位置跟踪问题，我们用一个简单的例子来说明卡尔曼滤波的工作原理。

假设我们有一个匀速运动的物体，状态向量包含位置和速度: $\mathbf{x}_k = [p_k, v_k]^T$。

系统模型为:
```
p_k = p_{k-1} + v_{k-1} * dt + w_p
v_k = v_{k-1} + w_v
```

其中 dt 是时间步长，w_p 和 w_v 是过程噪声。

对应的状态转移矩阵:
```
F_k = [ 1  dt ]
      [ 0  1  ]
```

假设我们只能测量位置，则观测矩阵:
```
H_k = [ 1  0 ]
```

初始设置:
- 初始状态估计: x̂₀ = [0, 1]ᵀ
- 初始误差协方差: P₀ = [ [100, 0], [0, 1] ]
- 过程噪声协方差: Q = [ [0.01, 0], [0, 0.01] ]
- 测量噪声协方差: R = [1]

图中红点表示带噪声的测量值，蓝线表示真实位置，绿线表示卡尔曼滤波估计的位置。可以看到，滤波结果更接近真实轨迹，有效滤除了测量噪声。

</details>

通过这个一维例子可以直观理解卡尔曼滤波的基本工作原理。对于更复杂的多维系统，原理是相同的，只是矩阵运算更加复杂。

## 总结

<div align="center">

**卡尔曼滤波的核心思想：将预测与测量融合，得到最优估计**

</div>

卡尔曼滤波是一种强大的状态估计工具，它能够在不确定和噪声环境中提供系统状态的最优估计。其优势在于:

1. **递归处理** - 无需存储所有历史数据，计算和存储需求小
2. **实时性** - 适合在线实时处理
3. **最优性** - 在线性高斯假设下提供MMSE最优估计
4. **不确定性度量** - 通过误差协方差提供估计的置信度

理解卡尔曼滤波的基本原理，是掌握其扩展形式（如EKF、UKF等）的基础，也是深入理解现代状态估计技术的关键。

---

[返回README](README.md) 